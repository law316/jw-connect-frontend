<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JW Registration</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    body {
      min-height: 100vh;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .bg-slider {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: -1;
    }

    .bg-slider img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 1.5s ease-in-out;
    }

    .bg-slider img.active {
      opacity: 1;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 0;
    }

    .register-box {
      max-width: 380px;
      width: 90%;
      margin: 40px auto;
      background: rgba(255, 255, 255, 0.18);
      backdrop-filter: blur(10px);
      padding: 22px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      position: relative;
      z-index: 2;
    }

    h2 {
      text-align: center;
      margin-bottom: 5px;
      font-size: 24px;
      font-weight: bold;
    }

    p.sub {
      text-align: center;
      color: #e5e5e5;
      margin-bottom: 15px;
      font-size: 14px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      margin-top: 10px;
      font-weight: bold;
      font-size: 13px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.35);
      background: rgba(255,255,255,0.25);
      color: white;
      outline: none;
      font-size: 14px;
    }

    input::placeholder {
      color: #eee;
    }

    select option {
      color: black;
      background: white;
    }

    button {
      width: 100%;
      padding: 12px;
      background: black;
      color: white;
      border: none;
      border-radius: 10px;
      margin-top: 15px;
      font-size: 15px;
      cursor: pointer;
      font-weight: bold;
      position: relative;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .spinner {
      width: 18px;
      height: 18px;
      border: 3px solid white;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    #statusMessage {
      margin-top: 10px;
      text-align: center;
      font-size: 14px;
      padding: 8px;
      border-radius: 6px;
      display: none;
    }

    .success { background: rgba(0, 255, 0, 0.2); color: #a3f7a3; }
    .error   { background: rgba(255, 0, 0, 0.2); color: #ffb3b3; }

    .preview-img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-top: 10px;
      border: 2px solid white;
      object-fit: cover;
    }
  </style>
</head>

<body>

  <div class="bg-slider" id="bgSlider"></div>
  <div class="overlay"></div>

  <div class="register-box">
    <h2>Create JW Profile</h2>
    <p class="sub">Connect with fellow Witnesses worldwide</p>

    <form id="registerForm">

      <label>Username</label>
      <input type="text" name="userName" required />

      <label>Email</label>
      <input type="email" name="email" required />

      <label>Password</label>
      <input type="password" name="password" required />

      <label>Gender</label>
      <select name="gender">
        <option>Male</option>
        <option>Female</option>
      </select>

      <label>Continent</label>
      <select name="location" id="continentSelect">
        <option>Africa</option>
        <option>Europe</option>
        <option>Asia</option>
        <option>North America</option>
        <option>South America</option>
        <option>Oceania</option>
      </select>

      <label>Country</label>
      <select name="country">
        <option>Nigeria</option><option>Ghana</option><option>Kenya</option><option>South Africa</option>
        <option>USA</option><option>UK</option><option>Canada</option>
      </select>

      <label>Favorite Bible Verse</label>
      <input type="text" name="bibleVerse" placeholder="Psalm 83:18" />

      <label>Your Interest</label>
      <input type="text" name="interest" placeholder="Share faith‚Ä¶" />

      <label>Profile Image</label>
      <input type="file" id="imageInput" accept="image/*" />
      <img id="previewImg" class="preview-img" style="display:none;" />

      <button type="submit" id="submitBtn">Create Account</button>

      <div id="statusMessage"></div>

    </form>
  </div>

<script>
/* Background slideshow */
const bgImages = [
  "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee",
  "https://images.unsplash.com/photo-1503264116251-35a269479413",
  "https://images.unsplash.com/photo-1501785888041-af3ef285b470",
  "https://images.unsplash.com/photo-1499084732479-de2c02d45fc4"
];

const slider = document.getElementById("bgSlider");

bgImages.forEach((src, i) => {
  const img = document.createElement("img");
  img.src = src;
  if (i === 0) img.classList.add("active");
  slider.appendChild(img);
});

let current = 0;
setInterval(() => {
  const slides = document.querySelectorAll("#bgSlider img");
  slides[current].classList.remove("active");
  current = (current + 1) % slides.length;
  slides[current].classList.add("active");
}, 5000);

/* CLOUDINARY UPLOAD */
async function uploadToCloudinary(file) {
  const cloudName = "dogfqkm8u";
  const preset = "jw images";  // EXACT NAME WITH SPACE

  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", preset);

  const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/image/upload`, {
    method: "POST",
    body: formData,
  });

  const data = await res.json();

  if (!res.ok) {
    console.log("Cloudinary Error:", data);
    throw new Error(data.error?.message || "Cloudinary upload failed");
  }

  return data.secure_url;
}

/* IMAGE PREVIEW + UPLOAD */
let finalImageURL = "";

document.getElementById("imageInput").addEventListener("change", async function () {
  const file = this.files[0];
  if (!file) return;

  const preview = document.getElementById("previewImg");
  preview.src = URL.createObjectURL(file);
  preview.style.display = "block";

  finalImageURL = await uploadToCloudinary(file);
});

/* SUBMIT FORM */
document.getElementById("registerForm").addEventListener("submit", async function (e) {
  e.preventDefault();

  const btn = document.getElementById("submitBtn");
  const statusBox = document.getElementById("statusMessage");

  if (!finalImageURL) {
    alert("Please wait, uploading image...");
    return;
  }

  btn.disabled = true;
  btn.innerHTML = `<div class="spinner"></div> Registering...`;
  statusBox.style.display = "none";

  const formData = new FormData(this);
  const payload = Object.fromEntries(formData.entries());

  payload.profileImage = finalImageURL;

  try {
    const res = await fetch("https://jwconnect.fly.dev/api/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (!res.ok) throw new Error("Server error");

    statusBox.className = "success";
    statusBox.innerHTML = "üéâ Registration Successful!";
    statusBox.style.display = "block";

    btn.innerHTML = "Success!";

    /* ‚úÖ REDIRECT AFTER SUCCESS */
    setTimeout(() => {
      window.location.href = "login.html";   // or "/login"
    }, 1500);

  }
  catch (err) {
    statusBox.className = "error";
    statusBox.innerHTML = "‚ùå Registration Failed. Please try again.";
    statusBox.style.display = "block";

    btn.disabled = false;
    btn.innerHTML = "Create Account";
  }
});
</script>

</body>
</html>
